<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dissara Luxury | Fine Jewellery</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Cormorant+Garamond:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/luxury.css?v=2" />
  <style>
    /* Themed select for Sort By */
    #shopSort{
      background: rgba(16,23,32,.9);
      color: var(--ink);
      border:1px solid rgba(212,175,55,.35);
      padding:8px 10px; border-radius:10px;
      appearance:none; -webkit-appearance:none; -moz-appearance:none;
      background-image: linear-gradient(45deg, transparent 50%, var(--ink) 50%),
                        linear-gradient(135deg, var(--ink) 50%, transparent 50%);
      background-position: calc(100% - 18px) calc(50% + 2px), calc(100% - 12px) calc(50% + 2px);
      background-size: 6px 6px, 6px 6px; background-repeat:no-repeat;
    }
    #shopSort:focus{ outline:none; border-color: var(--gold); box-shadow: 0 0 0 2px rgba(212,175,55,.25); }
    #shopSort option{ background:#101720; color:#e8eaee; }
    
    /* Button Clickability Fix */
    .btn-link, button[data-product], .add-to-cart {
      pointer-events: auto !important;
      cursor: pointer !important;
      z-index: 10;
    }
    
    /* Cart Dropdown Styling */
    .nav-actions {
      position: relative;
    }
    
    #cartDropdown {
      position: absolute;
      top: 100%;
      right: 0;
      margin-top: 0.5rem;
      display: none; /* Hide by default */
    }
    
    #cartDropdown.show {
      display: block; /* Show when has .show class */
    }

    .buy-now-btn {
      pointer-events: auto !important;
      cursor: pointer !important;
      z-index: 10;
      border: none;
      position: relative;
    }
  </style>
</head>
<body>
  <!-- Floating Navigation (unified) -->
    <header class="floating-nav">
      <div class="brand">
        <a href="index.html" aria-label="Home">
          <img src="logo.png" alt="Dissara" class="logo" />
        </a>
      </div>
      <nav class="navlinks">
        <a href="index.html">Home</a>
        <a href="gift-store.html">Gift Store</a>
        <a href="collections.html">Collections</a>
        <a href="index.html#newarrivals">New Arrivals</a>
        <a href="index.html#shopby">Shop By</a>
        <a href="index.html#contact">Contact</a>
        <a href="index.html#about">About Us</a>
        <span id="authSlot"></span>
        <div class="nav-actions">
          <button id="wishlistIconButton" class="nav-icon-btn">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.8" d="M12 21s-4.35-2.43-7.05-5.14C2.24 13.15 2 10.1 4.03 8.07a4.26 4.26 0 0 1 6.02.25L12 10.34l1.95-2.02a4.26 4.26 0 0 1 6.02-.25c2.03 2.03 1.79 5.08-.92 7.79C16.35 18.57 12 21 12 21z" />
            </svg>
            <span id="wishlistCount" class="nav-icon-badge" style="display:none;">0</span>
          </button>
          <button id="cartButton" class="nav-icon-btn">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
            </svg>
            <span id="cartCount" class="nav-icon-badge" style="display:none;">0</span>
          </button>

          <!-- Cart Dropdown -->
          <div id="cartDropdown" class="hidden absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-xl z-50 border border-gray-200" style="min-width: 320px;">
            <div class="p-4 border-b border-gray-200">
              <h3 class="text-lg font-semibold text-gray-800">Your Cart</h3>
            </div>
            <div id="cartItems" class="max-h-96 overflow-y-auto">
              <!-- Cart items will be added here dynamically -->
              <p class="text-center text-gray-500 py-4">Your cart is empty</p>
            </div>
            <div id="cartTotal" class="hidden p-4 border-t border-gray-200 bg-gray-50">
              <div class="flex justify-between items-center mb-2">
                <span class="font-medium text-gray-700">Total:</span>
                <span id="cartTotalAmount" class="font-bold text-lg text-gray-900">‚Çπ0.00</span>
              </div>
              <button id="checkoutBtn" class="w-full bg-[var(--gold)] text-white py-2 px-4 rounded-lg hover:bg-opacity-90 transition">
                Proceed to Checkout
              </button>
            </div>
          </div>
        </div>
      </nav>
    </header>

  <!-- Hero with Parallax and Animated Gold Accents -->
  <section class="hero" aria-label="Luxury diamond showcase">
    <div class="hero-inner">
      <div class="hero-copy" data-parallax="0.15">
        <div class="kicker">Handcrafted Elegance</div>
        <h1 class="h1-title">
          Sparkling <span class="shine">Diamond</span> Masterpieces
        </h1>
        <p class="lead">Timeless craftsmanship meets modern allure. Discover pieces that shimmer with a story‚Äîmade to be adored, forever.</p>
        <div class="hero-cta">
          <a class="btn-primary" href="collections.html">Explore Collection</a>
          <button class="btn-ghost">Our Heritage</button>
        </div>
      </div>
      <div class="hero-showcase" data-parallax="0.06">
        <div class="hero-card">
          <img src="mainpagepic.png" alt="Featured diamond jewellery" />
        </div>
        <!-- Animated sparkling accents -->
        <div class="sparks">
          <span class="spark s1"></span>
          <span class="spark s2 g"></span>
          <span class="spark s3"></span>
          <span class="spark s4 g"></span>
        </div>
      </div>
    </div>
  </section>

  <div class="divider" aria-hidden="true"></div>

  <!-- Signature Collections -->
  <section id="collections" class="section">
    <div class="container">
      <h2 class="section-title">Signature Collections</h2>
      <p class="lead" style="margin-bottom:28px">Curated lines inspired by celestial light, oceanic grace, and the bold geometry of the modern age.</p>
      <div class="gallery-grid" id="gallery">
        <a class="tile span-4x2" href="#" aria-label="Eternal Rings">
          <img src="mainpagepic.png" alt="Eternal Rings" />
          <span class="label">Eternal Rings</span>
        </a>
        <a class="tile span-3x3" href="#" aria-label="Celestial Drops">
          <img src="mainpagepic.png" alt="Celestial Drops" />
          <span class="label">Celestial Drops</span>
        </a>
        <a class="tile span-5x3" href="#" aria-label="Auric Chains">
          <img src="mainpagepic.png" alt="Auric Chains" />
          <span class="label">Auric Chains</span>
        </a>
        <a class="tile span-6x4" href="#" aria-label="Midnight Halo">
          <img src="mainpagepic.png" alt="Midnight Halo" />
          <span class="label">Midnight Halo</span>
        </a>
        <a class="tile span-4x4" href="#" aria-label="Luna Bracelets">
          <img src="mainpagepic.png" alt="Luna Bracelets" />
          <span class="label">Luna Bracelets</span>
        </a>
        <a class="tile span-3x3" href="#" aria-label="Gilded Studs">
          <img src="mainpagepic.png" alt="Gilded Studs" />
          <span class="label">Gilded Studs</span>
        </a>
      </div>
    </div>
  </section>

  <div class="divider" aria-hidden="true"></div>
  <div class="divider" aria-hidden="true"></div>

  <!-- Shop By / Products -->
  <section id="shopby" class="products">
    <div class="container">
      <h2 class="section-title">Curated Picks</h2>
      <p class="lead" style="margin-bottom:12px">Explore handpicked designs with dazzling brilliance and irresistible value.</p>
      <div id="shopFilters" style="display:flex; gap:10px; flex-wrap:wrap; margin-bottom:10px">
        <button class="btn-ghost" data-filter="all">All</button>
        <button class="btn-ghost" data-filter="rings">Rings</button>
        <button class="btn-ghost" data-filter="earrings">Earrings</button>
        <button class="btn-ghost" data-filter="necklaces">Necklaces</button>
        <button class="btn-ghost" data-filter="bracelets">Bracelets</button>
      </div>
      <div style="display:flex; justify-content:flex-end; margin-bottom:16px">
        <label style="display:flex; align-items:center; gap:8px">
          <span class="lead" style="font-size:.95rem">Sort By</span>
          <select id="shopSort" style="background:transparent; color:var(--ink); border:1px solid rgba(212,175,55,.35); padding:8px 10px; border-radius:10px">
            <option value="popular">Popular</option>
            <option value="price_asc">Price: Low to High</option>
            <option value="price_desc">Price: High to Low</option>
            <option value="discount_desc">Discount</option>
            <option value="rating_desc">Rating</option>
          </select>
        </label>
      </div>
      <div class="grid" id="productGrid"></div>
    </div>
  </section>

  <div class="divider" aria-hidden="true"></div>



  <!-- New Arrivals -->
  <section id="newarrivals" class="products">
    <div class="container">
      <h2 class="section-title">New Arrivals</h2>
      <p class="lead" style="margin-bottom:18px">Fresh drops‚Äîbe the first to shine.</p>
      <div class="grid" id="productNew"></div>
    </div>
  </section>

  <!-- About Section -->
  <section id="about" class="section">
    <div class="container">
      <div style="display:grid; grid-template-columns:1.1fr .9fr; gap:26px; align-items:center">
        <!-- <div>
          <h2 class="section-title">Crafted to Captivate</h2>
          <p class="lead">For over two decades, Dissara has united artisanal mastery with ethically sourced diamonds and precious metals. Every facet is polished for brilliance, every curve drawn for grace.</p>
          <div style="display:flex; gap:28px; margin-top:20px"> -->
            <div>
              <div style="color:var(--gold); font-weight:700; font-size:1.6rem">25+</div>
              Years of Excellence
            </div>
            <div>
              <div style="color:var(--gold); font-weight:700; font-size:1.6rem">10k+</div>
              Bespoke Creations
            </div>
          </div>
        </div>
        <!-- <div class="hero-card" data-parallax="0.08">
           <img src="mainpagepic.png" alt="Atelier craftsmanship" /> 
        </div>   -->
      </div>
    </div>
  </section>

  <div class="divider" aria-hidden="true"></div>

  <!-- Footer -->
  <footer id="contact" class="footer">
    <div class="container">
      <div class="cols">
        <div>
          <h3 class="section-title" style="margin-bottom:8px">Dissara</h3>
          <p class="lead">Luxury jewellery designed to be cherished today, tomorrow, and always.</p>
        </div>
        <div>
          <strong style="color:var(--ink)">Explore</strong><br/>
          <a href="collections.html">Collections</a><br/>
          <a href="#gallery">Gallery</a><br/>
          <a href="#about">About</a><br/>
        </div>
        <div>
          <strong style="color:var(--ink)">Contact</strong><br/>
          <a href="mailto:hello@dissara.example">hello@dissara.example</a><br/>
          <a href="#">Instagram</a>
        </div>
      </div>
    </div>
  </footer>

  <!-- Cart Dropdown -->
  <div id="cartDropdown" class="hidden absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-xl z-50 border border-gray-200">
    <div class="p-4">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-medium text-gray-900">Your Cart</h3>
        <button id="closeCart" class="text-gray-500 hover:text-gray-700">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div id="emptyCart" class="text-center py-8">
        <i class="fas fa-shopping-cart text-3xl text-gray-300 mb-2"></i>
        <p class="text-gray-500">Your cart is empty</p>
        <a href="collections.html" class="mt-2 inline-block text-purple-600 hover:underline text-sm">Continue Shopping</a>
      </div>
      
      <div id="cartContent" class="hidden">
        <div id="cartItems" class="max-h-96 overflow-y-auto -mx-4 px-4"></div>
        
        <div id="cartTotal" class="border-t border-gray-200 mt-4 pt-4">
          <div class="flex justify-between items-center mb-4">
            <span class="font-medium">Subtotal</span>
            <span id="cartTotalAmount" class="font-medium">‚Çπ0.00</span>
          </div>
          <a href="checkout.html" class="block w-full bg-purple-600 hover:bg-purple-700 text-white text-center py-2 rounded-md font-medium transition-colors">
            Proceed to Checkout
          </a>
          <div class="text-center mt-2">
            <a href="cart.html" class="text-sm text-purple-600 hover:underline">View Cart</a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Product Detail Modal -->
  <div class="modal" id="productModal" aria-hidden="true" role="dialog" aria-label="Product details" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1000; align-items: center; justify-content: center; padding: 20px;">
    <div class="backdrop" data-close="modal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7);"></div>
    <div class="panel" style="max-width: 800px; width: 100%; max-height: 90vh; overflow-y: auto; background: white; border-radius: 12px; position: relative; z-index: 1001;">
      <button class="close-x" id="modalClose" aria-label="Close" style="position: sticky; top: 15px; right: 15px; z-index: 10; background: rgba(0,0,0,0.7); border-radius: 50%; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border: none; color: white; cursor: pointer; float: right; margin: 10px;">‚úï</button>
      <div class="inner" style="display: flex; flex-direction: column; padding: 15px;">
        <!-- Product Image -->
        <div class="gal" style="width: 100%; padding: 10px; display: flex; justify-content: center; margin-bottom: 15px;">
          <img id="modalImage" src="" alt="Product image" style="max-width: 300px; max-height: 300px; object-fit: contain;" />
        </div>
        <!-- Product Info -->
        <div class="info" style="padding: 10px;">
          <h3 id="modalTitle" style="margin: 0 0 10px 0; font-size: 1.3rem; color: #333; line-height: 1.3;">Product</h3>
          <div class="meta" style="margin-bottom: 10px; display: flex; align-items: center; gap: 6px; color: #666; font-size: 0.85rem;">
            <span id="modalBrand" style="font-weight: 500;">DISSARA</span>
            <span class="dot" style="font-size: 1.1em;">‚Ä¢</span>
            <span id="modalRating" style="color: #f5a623; font-size: 0.9em;">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
          </div>
          <div class="price" style="margin: 8px 0 15px 0; display: flex; align-items: center; flex-wrap: wrap; gap: 6px;">
            <span class="now" id="modalNow" style="font-size: 1.2rem; font-weight: 600; color: #8b5cf6;">Rs. 0</span>
            <span class="mrp" id="modalMrp" style="text-decoration: line-through; color: #999; font-size: 0.9rem;">Rs. 0</span>
            <span class="badge" id="modalDisc" style="background: #f0f0f0; color: #333; padding: 2px 8px; border-radius: 8px; font-size: 0.75rem; font-weight: 500;">-00% OFF</span>
          </div>
          
          <!-- Quantity Selector -->
          <div class="quantity-selector" style="margin: 15px 0; display: flex; align-items: center; gap: 10px;">
            <span style="font-weight: 500; color: #333;">Quantity:</span>
            <div style="display: flex; align-items: center; border: 1px solid #ddd; border-radius: 6px; overflow: hidden;">
              <button id="decreaseQty" style="background: #f5f5f5; border: none; padding: 5px 12px; cursor: pointer; font-size: 1.1rem;">-</button>
              <span id="quantity" style="padding: 5px 15px; min-width: 30px; text-align: center; font-weight: 500;">1</span>
              <button id="increaseQty" style="background: #f5f5f5; border: none; padding: 5px 12px; cursor: pointer; font-size: 1.1rem;">+</button>
            </div>
          </div>
          
          <div class="cta" style="margin: 20px 0; display: flex; gap: 10px; flex-wrap: wrap;">
            <button id="addToCartBtn" class="btn-primary solid" style="flex: 1; min-width: 160px; padding: 10px; border-radius: 8px; background: #8b5cf6; color: white; border: none; font-weight: 600; cursor: pointer; transition: all 0.2s;">
              Add to Cart
            </button>
            <button class="btn-ghost small" data-close="modal" style="padding: 10px 16px; border-radius: 8px; background: #f5f5f5; border: 1px solid #ddd; cursor: pointer; transition: all 0.2s;">
              Close
            </button>
          </div>
          
          <div class="specs" id="modalSpecs" style="margin: 15px 0; font-size: 0.9rem; line-height: 1.5; color: #444;"></div>
          <div class="reviews" id="modalReviews" style="margin-top: 15px; padding-top: 12px; border-top: 1px solid #eee; font-size: 0.85rem; color: #555;">
            <h4 style="margin: 0 0 10px 0; font-size: 1rem; color: #333;">Product Details</h4>
            <div id="productDescription" style="line-height: 1.6;"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Floating Chatbot -->
  <button class="chatbot-btn" id="chatbotBtn" aria-label="Open Chatbot">üí¨</button>
  <div class="chatbot-popup" id="chatbotPopup" aria-hidden="true">
    <iframe src="chatbot.html" title="Dissara Chatbot"></iframe>
  </div>

  <script src="assets/js/luxury.js?v=2"></script>
  <script src="assets/js/cart.js"></script>
  <script>
    // Sync wishlist heart badge with localStorage data on home page
    function updateWishlistCount() {
      try {
        const data = JSON.parse(localStorage.getItem('wishlist')) || [];
        const badge = document.getElementById('wishlistCount');
        if (!badge) return;
        const count = Array.isArray(data) ? data.length : 0;
        badge.textContent = count > 99 ? '99+' : String(count);
        badge.style.display = count > 0 ? 'flex' : 'none';
      } catch (e) {
        console.error('Error updating wishlist count', e);
      }
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', updateWishlistCount);
    } else {
      updateWishlistCount();
    }
  </script>
  <script>
    // Cart functionality
    let cart = JSON.parse(localStorage.getItem('cart')) || [];
    const cartCount = document.getElementById('cartCount');
    const cartItems = document.getElementById('cartItems');
    const cartTotal = document.getElementById('cartTotal');
    const cartTotalAmount = document.getElementById('cartTotalAmount');
    const cartButton = document.getElementById('cartButton');
    const cartDropdown = document.getElementById('cartDropdown');
    const checkoutBtn = document.getElementById('checkoutBtn');
    
    // Initialize components when DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize modal
      const modal = document.getElementById('productModal');
      const modalClose = document.getElementById('modalClose');
      const addToCartBtn = document.getElementById('addToCartBtn');
      const increaseQty = document.getElementById('increaseQty');
      const decreaseQty = document.getElementById('decreaseQty');
      const quantityEl = document.getElementById('quantity');
      
      // Initialize cart display
      updateCartCount();
      updateCartDisplay();
      
      // Toggle cart dropdown
      if (cartButton) {
        cartButton.addEventListener('click', (e) => {
          e.stopPropagation();
          cartDropdown.classList.toggle('hidden');
        });
      }
      
      // Close cart when clicking outside
      document.addEventListener('click', (e) => {
        if (cartDropdown && !cartDropdown.contains(e.target) && e.target !== cartButton) {
          cartDropdown.classList.add('hidden');
        }
      });
      
      // Quantity controls
      if (increaseQty && decreaseQty && quantityEl) {
        increaseQty.addEventListener('click', () => {
          const currentQty = parseInt(quantityEl.textContent);
          quantityEl.textContent = currentQty + 1;
        });
        
        decreaseQty.addEventListener('click', () => {
          const currentQty = parseInt(quantityEl.textContent);
          if (currentQty > 1) {
            quantityEl.textContent = currentQty - 1;
          }
        });
      }
      
      // Add to cart functionality
      if (addToCartBtn) {
        addToCartBtn.addEventListener('click', function() {
          const product = {
            id: Date.now().toString(),
            name: document.getElementById('modalTitle').textContent,
            price: parseFloat(document.getElementById('modalNow').textContent.replace('Rs. ', '')),
            image: document.getElementById('modalImage').src,
            quantity: parseInt(quantityEl.textContent),
            brand: document.getElementById('modalBrand').textContent,
            size: selectedSize,
            color: selectedColor
          };
          
          // Add to cart using the shared function
          addToCart(product);
          
          // Close modal after adding to cart
          if (modal) modal.style.display = 'none';
          
          // Auto-open cart dropdown
          const cartDropdown = document.getElementById('cartDropdown');
          if (cartDropdown) {
            cartDropdown.classList.remove('hidden');
            // Ensure cart is updated in the UI
            updateCartDisplay();
          }
        });
      }
      
      // Close modal handlers
      if (modal && modalClose) {
        modalClose.addEventListener('click', function() {
          modal.style.display = 'none';
        });
        
        // Close modal when clicking outside content
        modal.addEventListener('click', function(e) {
          if (e.target === modal) {
            modal.style.display = 'none';
          }
        });
      }
      
      // Handle checkout
      if (checkoutBtn) {
        checkoutBtn.addEventListener('click', function() {
          if (cart.length === 0) {
            showNotification('Your cart is empty');
            return;
          }
          // Here you would typically redirect to checkout page
          alert('Proceeding to checkout with ' + cart.length + ' items');
        });
      }
    });
    
    // Update cart count in the header
    function updateCartCount() {
      if (!cartCount) return;
      const totalItems = cart.reduce((sum, item) => sum + (item.quantity || 1), 0);
      const cartCounters = document.querySelectorAll('.cart-count');
      
      cartCounters.forEach(el => {
        el.textContent = totalItems > 99 ? '99+' : totalItems;
        el.style.display = totalItems > 0 ? 'flex' : 'none';
      });
      
      if (cartCount) {
        cartCount.textContent = totalItems > 99 ? '99+' : totalItems;
      }
    }
    
    // Update cart display in dropdown
    function updateCartDisplay() {
      if (!cartItems) return;
      
      if (cart.length === 0) {
        cartItems.innerHTML = '<p class="text-center text-gray-500 py-4">Your cart is empty</p>';
        if (cartTotal) cartTotal.classList.add('hidden');
        return;
      }
      
      cartItems.innerHTML = '';
      let total = 0;
      
      cart.forEach((item, index) => {
        const itemTotal = (item.price || 0) * (item.quantity || 1);
        total += itemTotal;
        
        const itemElement = document.createElement('div');
        itemElement.className = 'flex items-start py-3 border-b border-gray-200';
        itemElement.innerHTML = `
          <img src="${item.image || 'https://via.placeholder.com/64'}" alt="${item.name}" class="w-16 h-16 object-cover rounded-lg mr-3">
          <div class="flex-1">
            <h4 class="font-medium text-[var(--navy)]">${item.name}</h4>
            <p class="text-sm text-gray-600">Qty: ${item.quantity || 1}</p>
            <p class="text-sm font-medium">‚Çπ${item.price?.toFixed(2) || '0.00'}</p>
          </div>
          <button class="text-xs text-red-500 hover:text-red-700 remove-item" data-index="${index}">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
            </svg>
          </button>
        `;
        cartItems.appendChild(itemElement);
      });
      
      // Add event listeners to remove buttons
      document.querySelectorAll('.remove-item').forEach(button => {
        button.addEventListener('click', (e) => {
          e.stopPropagation();
          const index = parseInt(e.target.closest('.remove-item').getAttribute('data-index'));
          cart.splice(index, 1);
          localStorage.setItem('cart', JSON.stringify(cart));
          updateCartCount();
          updateCartDisplay();
          showNotification('Item removed from cart');
        });
      });
      
      // Update total
      if (cartTotal && cartTotalAmount) {
        cartTotalAmount.textContent = `‚Çπ${total.toFixed(2)}`;
        cartTotal.classList.remove('hidden');
      }
    }
    
    // Show notification
    function showNotification(message, isError = false) {
      // Remove any existing notifications
      document.querySelectorAll('.notification').forEach(el => el.remove());
      
      const notification = document.createElement('div');
      notification.className = 'notification';
      notification.innerHTML = `
        <div style="position: fixed; bottom: 20px; right: 20px; background: ${isError ? '#f87171' : '#4CAF50'}; color: white; padding: 12px 24px; border-radius: 4px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); z-index: 1000; animation: slideIn 0.3s ease-out; display: flex; align-items: center; gap: 8px;">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            ${isError ? '<circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line>' : '<path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline>'}
          </svg>
          ${message}
        </div>
      `;
      document.body.appendChild(notification);
      
      // Auto-remove notification after delay
      setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease-out';
        setTimeout(() => notification.remove(), 300);
      }, 3000);
    }
    
    // Add CSS for notifications and cart
    const style = document.createElement('style');
    style.textContent = `
      @keyframes slideIn {
        from { transform: translateY(100px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
      }
      @keyframes slideOut {
        from { transform: translateY(0); opacity: 1; }
        to { transform: translateY(100px); opacity: 0; }
      }
      .notification {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 1000;
      }
      .cart-count {
        position: absolute;
        top: -8px;
        right: -8px;
        background: #8b5cf6;
        color: white;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        font-size: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .hidden {
        display: none !important;
      }
    `;
    document.head.appendChild(style);

  // Toggle cart dropdown
  if (cartButton) {
    cartButton.addEventListener('click', (e) => {
      e.stopPropagation();
      cartDropdown.classList.toggle('hidden');
    });
  }

  // Close cart when clicking outside
  document.addEventListener('click', (e) => {
    if (cartDropdown && !cartDropdown.contains(e.target) && e.target !== cartButton) {
      cartDropdown.classList.add('hidden');
    }
  });

  // Update cart count
  function updateCartCount() {
    const count = cart.reduce((total, item) => total + (item.quantity || 1), 0);
    if (cartCount) cartCount.textContent = count;
    localStorage.setItem('cart', JSON.stringify(cart));
    updateCartDisplay();
  }

  // Update cart display
  function updateCartDisplay() {
    if (!cartItems) return;
    
    if (cart.length === 0) {
      cartItems.innerHTML = '<p class="text-center text-gray-500 py-4">Your cart is empty</p>';
      if (cartTotal) cartTotal.classList.add('hidden');
      return;
    }

    cartItems.innerHTML = '';
    let total = 0;

    cart.forEach((item, index) => {
      const itemTotal = (item.price + (item.addNote ? 30 : 0) + (item.giftWrap ? 50 : 0)) * (item.quantity || 1);
      total += itemTotal;
      
      const itemElement = document.createElement('div');
      itemElement.className = 'flex items-start py-3 border-b border-gray-200';
      itemElement.innerHTML = `
        <img src="${item.image || 'https://via.placeholder.com/64'}" alt="${item.name}" class="w-16 h-16 object-cover rounded-lg mr-3">
        <div class="flex-1">
          <h4 class="font-medium text-[var(--navy)]">${item.name}</h4>
          <p class="text-sm text-gray-600">Qty: ${item.quantity || 1}</p>
          ${item.addNote ? `<p class="text-xs text-gray-500 mt-1">Note: ${item.noteText || 'No note'}</p>` : ''}
          ${item.giftWrap ? '<p class="text-xs text-[var(--gold)] mt-1">Gift Wrapped</p>' : ''}
        </div>
        <div class="text-right">
          <p class="font-medium">‚Çπ${itemTotal.toFixed(2)}</p>
          <button class="text-xs text-red-500 hover:text-red-700 remove-item" data-index="${index}">Remove</button>
        </div>
      `;
      cartItems.appendChild(itemElement);
    });

    // Add event listeners to remove buttons
    document.querySelectorAll('.remove-item').forEach(button => {
      button.addEventListener('click', (e) => {
        const index = e.target.getAttribute('data-index');
        cart.splice(index, 1);
        updateCartCount();
      });
    });

    if (cartTotal) {
      cartTotalAmount.textContent = `‚Çπ${total.toFixed(2)}`;
      cartTotal.classList.remove('hidden');
    }
  }

  // Handle checkout
  if (checkoutBtn) {
    checkoutBtn.addEventListener('click', function() {
      alert('Proceeding to checkout with ' + cart.length + ' items');
      // Here you would typically redirect to checkout page
    });
  }

  // Initialize cart on page load
  document.addEventListener('DOMContentLoaded', () => {
    updateCartCount();
    updateCartDisplay();
    // Profile side panel
    const side = document.createElement('div');
    side.id = 'profileSide';
    side.setAttribute('aria-hidden','true');
    side.style.cssText = 'position:fixed;top:0;right:-340px;height:100vh;width:min(320px,92vw);background:var(--panel);border-left:1px solid rgba(212,175,55,.35);box-shadow: -20px 0 60px rgba(0,0,0,.5);z-index:1400;transition:right .25s ease; padding:16px; display:flex; flex-direction:column; gap:10px';
    side.innerHTML = `
      <div style="display:flex; justify-content:space-between; align-items:center">
        <div style="font-weight:800">Your Profile</div>
        <button id="sideClose" class="close-x" style="position:static;width:auto;height:auto;padding:6px 10px">Close</button>
      </div>
      <a href="my-orders.html" style="text-decoration:none; color:var(--ink); border:1px solid rgba(212,175,55,.3); padding:10px 12px; border-radius:12px; font-weight:700">My Orders</a>
      <a href="collections.html" style="text-decoration:none; color:var(--ink); border:1px solid rgba(212,175,55,.3); padding:10px 12px; border-radius:12px; font-weight:700">Collections</a>
      <a href="#contact" style="text-decoration:none; color:var(--ink); border:1px solid rgba(212,175,55,.3); padding:10px 12px; border-radius:12px; font-weight:700">Contact</a>
      <a href="#about" style="text-decoration:none; color:var(--ink); border:1px solid rgba(212,175,55,.3); padding:10px 12px; border-radius:12px; font-weight:700">About Us</a>
    `;
    document.body.appendChild(side);
    const openSide = ()=>{ side.style.right='0'; side.setAttribute('aria-hidden','false'); };
    const closeSide = ()=>{ side.style.right='-340px'; side.setAttribute('aria-hidden','true'); };
    document.addEventListener('click', (e)=>{ if(side.getAttribute('aria-hidden')==='false' && !side.contains(e.target) && !e.target.closest('#authSlot')){ closeSide(); } });
    document.getElementById('sideClose')?.addEventListener('click', closeSide);

    // Auth: render profile if signed in, else Login button
    function renderAuth(){
      const slot = document.getElementById('authSlot');
      const user = JSON.parse(localStorage.getItem('user')||'null');
      if(!slot) return;
      if(user){
        slot.innerHTML = '<button id="profileBtn" title="Profile" style="background:linear-gradient(90deg, var(--gstart), var(--gend)); color:#0a0d10; border:none; width:42px; height:42px; border-radius:50%; cursor:pointer; display:flex; align-items:center; justify-content:center; font-weight:800; box-shadow:0 8px 22px rgba(212,175,55,.25)">üë§</button>';
        document.getElementById('profileBtn').addEventListener('click', (e)=>{ e.stopPropagation(); openSide(); });
        // Inject Logout into side panel if not present
        if(!document.getElementById('logoutBtn')){
          const btn = document.createElement('button');
          btn.id='logoutBtn'; btn.textContent='Log out';
          btn.style.cssText='margin-top:6px; background:transparent; color:var(--ink); border:1px solid rgba(212,175,55,.35); padding:10px 12px; border-radius:12px; font-weight:700; cursor:pointer';
          document.getElementById('profileSide').appendChild(btn);
          btn.addEventListener('click', ()=>{ localStorage.removeItem('user'); closeSide(); renderAuth(); });
        }
      } else {
        slot.innerHTML = '<button id="loginBtn" title="Login" style="background:transparent; border:1px solid rgba(212,175,55,.45); color:var(--ink); border-radius:12px; padding:8px 12px; cursor:pointer; font-weight:800">Login</button>';
        document.getElementById('loginBtn').addEventListener('click', (e)=>{ e.preventDefault(); openAuthModal(); });
        const logout = document.getElementById('logoutBtn'); if(logout) logout.remove();
      }
    }

    // Auth modal with users registry and improved UI
    function openAuthModal(){
      let backdrop = document.getElementById('authBackdrop');
      if(!backdrop){
        backdrop = document.createElement('div'); backdrop.id='authBackdrop';
        backdrop.style.cssText='position:fixed;inset:0;background:rgba(0,0,0,.6);display:flex;align-items:center;justify-content:center;z-index:1600';
        const panel = document.createElement('div');
        panel.style.cssText='width:min(640px,94%);background:linear-gradient(180deg, rgba(16,23,32,.97), rgba(11,15,20,.98));border:1px solid rgba(212,175,55,.34);border-radius:20px;box-shadow:0 40px 120px rgba(0,0,0,.7);overflow:hidden';
        panel.innerHTML = `
          <div style="background:linear-gradient(90deg, var(--gstart), var(--gend)); padding:16px; color:#0a0d10; display:flex; justify-content:space-between; align-items:center">
            <div style="font-weight:900; letter-spacing:.04em">Welcome to Dissara</div>
            <button id="authClose" class="close-x" style="position:static;width:auto;height:auto;padding:6px 10px; border-color:rgba(0,0,0,.2); color:#0a0d10">Close</button>
          </div>
          <div style="padding:16px">
            <div id="authTabs" style="display:flex;gap:10px;margin-bottom:14px">
              <button id="tabLogin" style="padding:8px 14px; border-radius:999px; border:1px solid rgba(212,175,55,.35); background:transparent; color:var(--ink); font-weight:800">Login</button>
              <button id="tabSignup" style="padding:8px 14px; border-radius:999px; border:1px solid rgba(212,175,55,.35); background:transparent; color:var(--ink); font-weight:800">Sign Up</button>
            </div>
            <div id="authForms"></div>
            <div id="authErr" style="color:#f87171;font-weight:700;display:none;margin-top:8px"></div>
            <div id="authHint" class="lead" style="color:var(--muted); margin-top:6px"></div>
          </div>
        `;
        backdrop.appendChild(panel);
        document.body.appendChild(backdrop);
        backdrop.addEventListener('click', (e)=>{ if(e.target===backdrop) backdrop.remove(); });
        document.getElementById('authClose').addEventListener('click', ()=>backdrop.remove());
        // Tabs
        const forms = document.getElementById('authForms');
        const tabs = { login: document.getElementById('tabLogin'), signup: document.getElementById('tabSignup') };
        function setActive(which){
          [tabs.login,tabs.signup].forEach(b=>{ b.style.background='transparent'; b.style.color='var(--ink)'; });
          const active = which==='login'? tabs.login: tabs.signup;
          active.style.background='linear-gradient(90deg, var(--gstart), var(--gend))';
          active.style.color='#0a0d10';
        }
        function renderLogin(){
          setActive('login');
          forms.innerHTML = `
            <div style="display:grid;gap:12px; grid-template-columns:1fr 1fr; align-items:start">
              <div style="display:grid; gap:10px">
                <label>Email</label>
                <input id="liEmail" class="input" placeholder="you@example.com" style="background:transparent;border:1px solid rgba(212,175,55,.3);color:var(--ink);padding:10px;border-radius:10px"/>
                <label>Password</label>
                <input id="liPass" class="input" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" style="background:transparent;border:1px solid rgba(212,175,55,.3);color:var(--ink);padding:10px;border-radius:10px"/>
                <button id="doLogin" class="btn-primary" style="padding:10px 14px;border-radius:12px;font-weight:800">Login</button>
              </div>
              <div style="border-left:1px solid rgba(212,175,55,.18); padding-left:14px; color:var(--muted)">
                <div style="font-weight:800; margin-bottom:6px">New here?</div>
                Create an account to track orders, save cart and get offers.
              </div>
            </div>`;
          document.getElementById('doLogin').onclick = ()=>{
            const email = document.getElementById('liEmail').value.trim();
            const pass = document.getElementById('liPass').value.trim();
            const ebox=document.getElementById('authErr'); const hint=document.getElementById('authHint');
            if(!email || !pass){ ebox.textContent='Enter email and password.'; ebox.style.display='block'; return; }
            const users = JSON.parse(localStorage.getItem('users')||'[]');
            const found = users.find(u=>u.email.toLowerCase()===email.toLowerCase());
            if(!found){ ebox.textContent='No account found. Please sign up first.'; ebox.style.display='block'; tabs.signup.click(); return; }
            if(found.pass !== pass){ ebox.textContent='Incorrect password. Try again.'; ebox.style.display='block'; return; }
            localStorage.setItem('user', JSON.stringify({email, name: found.name||email.split('@')[0]}));
            document.getElementById('authErr').style.display='none';
            backdrop.remove(); renderAuth();
          };
        }
        function renderSignup(){
          setActive('signup');
          forms.innerHTML = `
            <div style="display:grid;gap:12px; grid-template-columns:1fr 1fr; align-items:start">
              <div style="display:grid; gap:10px">
                <label>Full Name</label>
                <input id="suName" class="input" placeholder="Aadhya Verma" style="background:transparent;border:1px solid rgba(212,175,55,.3);color:var(--ink);padding:10px;border-radius:10px"/>
                <label>Email</label>
                <input id="suEmail" class="input" placeholder="you@example.com" style="background:transparent;border:1px solid rgba(212,175,55,.3);color:var(--ink);padding:10px;border-radius:10px"/>
                <label>Password</label>
                <input id="suPass" class="input" type="password" placeholder="Create a password" style="background:transparent;border:1px solid rgba(212,175,55,.3);color:var(--ink);padding:10px;border-radius:10px"/>
                <button id="doSignup" class="btn-primary" style="padding:10px 14px;border-radius:12px;font-weight:800">Create Account</button>
              </div>
              <div style="border-left:1px solid rgba(212,175,55,.18); padding-left:14px; color:var(--muted)">
                <div style="font-weight:800; margin-bottom:6px">Why join?</div>
                Access faster checkout, order tracking and exclusive offers.
              </div>
            </div>`;
          document.getElementById('doSignup').onclick = ()=>{
            const name=document.getElementById('suName').value.trim();
            const email=document.getElementById('suEmail').value.trim();
            const pass=document.getElementById('suPass').value.trim();
            const ebox=document.getElementById('authErr');
            if(!name||!email||!pass){ ebox.textContent='Please fill all fields.'; ebox.style.display='block'; return; }
            const users = JSON.parse(localStorage.getItem('users')||'[]');
            if(users.find(u=>u.email.toLowerCase()===email.toLowerCase())){ ebox.textContent='Account already exists. Please login.'; ebox.style.display='block'; tabs.login.click(); return; }
            users.push({name, email, pass});
            localStorage.setItem('users', JSON.stringify(users));
            localStorage.setItem('user', JSON.stringify({name, email}));
            document.getElementById('authErr').style.display='none';
            backdrop.remove(); renderAuth();
          };
        }
        tabs.login.onclick = renderLogin;
        tabs.signup.onclick = renderSignup;
        renderLogin();
      }
    }

    renderAuth();
  
    // Shop By: data + renderer
    const PRODUCTS = [
      {id:101, name:'Auric Radiance Necklace', image:'mainpagepic.png', price:12999, mrp:18999, category:'necklaces', gender:'women'},
      {id:102, name:'Celestial Drop Earrings', image:'jewel11.webp', fallback:'jewel1.webp', price:8999, mrp:12999, category:'earrings', gender:'women'},
      {id:103, name:'Gilded Halo Ring', image:'jewel1.webp', price:7499, mrp:10499, category:'rings', gender:'women'},
      {id:104, name:'Midnight Tennis Bracelet', image:'mainpagepic.png', price:15999, mrp:21999, category:'bracelets', gender:'men'},
      {id:105, name:'Luna Pendant', image:'mainpagepic.png', price:5999, mrp:8999, category:'necklaces', gender:'women'},
      {id:106, name:'Aurora Studs', image:'jewel11.webp', fallback:'jewel1.webp', price:4499, mrp:6499, category:'earrings', gender:'women'}
    ];
    const grid = document.getElementById('productGrid');
    function currency(n){ return '‚Çπ' + Number(n||0).toLocaleString('en-IN'); }
    function cardHTML(p){
      const dp = Math.max(0, Math.round((1 - p.price/p.mrp)*100));
      const data = {
        id:p.id, name:p.name, price:p.price, image:p.image, quantity:1
      };
      const json = encodeURIComponent(JSON.stringify(data));
      return `
        <div class="card">
          <div class="media">
            <img src="${p.image}" alt="${p.name}" onerror="this.onerror=null; this.src='${p.fallback||p.image}'"/>
            <span class="badge">-${dp}%</span>
          </div>
          <div class="content">
            <div class="title">${p.name}</div>
            <div class="price"><span class="now">${currency(p.price)}</span> <span class="mrp">${currency(p.mrp)}</span></div>
            <div class="actions">
              <button class="btn-link add-to-cart" data-product="${decodeURIComponent(json)}">Add to Cart</button>
              <a class="btn-link" href="collections.html">View</a>
            </div>
          </div>
        </div>`;
    }
    function render(filter){
      let list = PRODUCTS.slice();
      if(filter && filter!=='all'){
        if(filter==='men' || filter==='women'){
          list = list.filter(p=>p.gender===filter);
        } else {
          list = list.filter(p=>p.category===filter);
        }
      }
      // apply sorting
      const sortSel = document.getElementById('shopSort')?.value || 'popular';
      const withDisc = list.map(p=>({ ...p, _disc: Math.max(0, Math.round((1 - p.price/p.mrp)*100)) }));
      if(sortSel==='price_asc') withDisc.sort((a,b)=>a.price-b.price);
      else if(sortSel==='price_desc') withDisc.sort((a,b)=>b.price-a.price);
      else if(sortSel==='discount_desc') withDisc.sort((a,b)=>b._disc-a._disc);
      else if(sortSel==='rating_desc') withDisc.sort((a,b)=> (b.rating||0)-(a.rating||0));
      grid.innerHTML = withDisc.map(cardHTML).join('');
      
      // Attach click handlers to newly rendered buttons
      grid.querySelectorAll('.add-to-cart').forEach(btn => {
        btn.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          const json = this.getAttribute('data-product');
          if (json) {
            try {
              const item = JSON.parse(decodeURIComponent(json));
              item.quantity = item.quantity || 1;
              cart.push(item);
              localStorage.setItem('cart', JSON.stringify(cart));
              updateCartCount();
              showNotification('‚ú® Item added to cart!');
            } catch (err) {
              console.error('Parse error:', err);
            }
          }
        });
      });
    }
    render('all');
    document.getElementById('shopFilters')?.addEventListener('click', (e)=>{
      const btn = e.target.closest('button[data-filter]');
      if(!btn) return;
      render(btn.getAttribute('data-filter'));
    });
    document.getElementById('shopSort')?.addEventListener('change', ()=>{
      render(currentFilter || 'all');
    });

    // Navbar Shop By dropdown behavior
    const sbLink = document.getElementById('shopbyLink');
    const sbMenu = document.getElementById('shopbyMenu');
    const sbWrap = document.getElementById('shopbyWrap');
    let currentFilter = 'all';
    if(sbLink && sbMenu){
      sbLink.addEventListener('click', (e)=>{
        e.preventDefault();
        sbMenu.style.display = sbMenu.style.display==='block' ? 'none' : 'block';
      });
      sbMenu.addEventListener('click', (e)=>{
        const b = e.target.closest('button[data-sel]');
        if(!b) return;
        const sel = b.getAttribute('data-sel');
        // Redirect to Collections page with filter param
        window.location.href = `collections.html?filter=${encodeURIComponent(sel)}`;
      });
      document.addEventListener('click', (e)=>{
        if(!sbWrap.contains(e.target)) sbMenu.style.display='none';
      });
    }

    // Global delegated Add to Cart (buttons with data-product JSON or .add-to-cart)
    document.body.addEventListener('click', (e)=>{
      const btn = e.target.closest('[data-product], .add-to-cart');
      if(!btn) return;
      e.preventDefault();
      e.stopPropagation();
      try{
        const json = btn.getAttribute('data-product');
        let item = json ? JSON.parse(decodeURIComponent(json)) : null;
        if(!item){ // fallback minimal data
          item = { name: btn.getAttribute('data-name')||'Item', price: Number(btn.getAttribute('data-price')||0), image: btn.getAttribute('data-image')||'' };
        }
        item.quantity = item.quantity || 1;
        cart.push(item);
        localStorage.setItem('cart', JSON.stringify(cart));
        updateCartCount();
        showNotification('Item added to cart!');
      }catch(err){ console.error('Add to cart error:', err); }
    });
  });
  </script>
  
  <script>
    // Cart Dropdown Toggle
    document.addEventListener('DOMContentLoaded', function() {
      const cartButton = document.getElementById('cartButton');
      const cartDropdown = document.getElementById('cartDropdown');
      
      if (cartButton && cartDropdown) {
        // Toggle cart dropdown on button click
        cartButton.addEventListener('click', function(e) {
          e.stopPropagation();
          cartDropdown.classList.toggle('show');
        });
        
        // Close cart when clicking outside
        document.addEventListener('click', function(e) {
          if (!cartDropdown.contains(e.target) && !cartButton.contains(e.target)) {
            cartDropdown.classList.remove('show');
          }
        });
      }
    });
  </script>
  <script>
    document.addEventListener('click', function(e) {
      const btn = e.target.closest('.buy-now-btn');
      if (!btn) return;
      // ... handle click
      console.log('‚úÖ DIRECT LISTENER: Button clicked!');
    }, true); // ‚Üê Capture phase = catches ALL clicks!
  </script>
</body>
</html>
