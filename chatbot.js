// Enhanced Knowledge Base for Perry the Jewelry Assistant
const jewelryKnowledge = {
  greetings: [
    "Namaste! üôè I'm Perry, your personal jewelry assistant at Dissara. It's wonderful to meet you! I'm here to help you discover our exquisite collection of fine jewelry. How may I assist you today?",
    "Hello and welcome! üëã I'm Perry, your friendly jewelry expert at Dissara. Whether you're looking for traditional Indian jewelry or contemporary designs, I'm here to help. What would you like to explore today?",
    "Greetings! ‚ú® I'm Perry, your personal jewelry consultant at Dissara. I can help you find anything from stunning gold necklaces to elegant diamond rings. What brings you in today?",
    "Hi there! üíé I'm Perry, your go-to jewelry specialist at Dissara. I'd love to help you find something special. What kind of jewelry are you interested in?",
    "Namaskar! üå∫ I'm Perry, your jewelry guide at Dissara. Whether it's for a special occasion or just because, I'm here to help you find the perfect piece. How can I assist you today?"
  ],
  aboutDissara: [
    "Dissara is a premier jewelry brand that celebrates India's rich heritage of jewelry-making. We specialize in handcrafted pieces that blend traditional Indian craftsmanship with modern designs. Our collections feature 22K gold, kundan, polki, and diamond jewelry that's perfect for weddings, festivals, and special occasions.",
    "At Dissara, we take pride in creating jewelry that tells a story. Each piece is meticulously crafted by skilled artisans using age-old techniques passed down through generations. From bridal sets to everyday wear, our collection includes gold, diamond, and gemstone jewelry that embodies elegance and tradition."
  ],
  collections: [
    "‚ú® Our Exquisite Collections ‚ú®\n\n1. Bridal Collection\n   - Heavy kundan sets\n   - Polki jewelry\n   - Temple jewelry\n   - Jadau sets\n\n2. Daily Wear\n   - Lightweight gold chains\n   - Diamond studs\n   - Gemstone pendants\n   - Modern gold bangles\n\n3. Festive Special\n   - Antique finish necklaces\n   - Meenakari jewelry\n   - Pearl sets\n   - Diamond chokers\n\n4. Custom Designs\n   - Bespoke jewelry\n   - Remake old gold\n   - Personalized name necklaces\n   - Birthstone jewelry\n\nWhich collection would you like to explore further?",
    "üåü Discover Our Signature Lines üåü\n\n‚Ä¢ The Royal Mughal Collection: Inspired by India's royal heritage, featuring intricate kundan and polki work\n\n‚Ä¢ Nava Ratna: Nine-gemstone jewelry for astrological benefits\n\n‚Ä¢ Temple Collection: Traditional South Indian temple jewelry with antique finish\n\n‚Ä¢ Modern Minimalist: Contemporary designs for everyday elegance\n\n‚Ä¢ Bridal Couture: Grand sets for the modern Indian bride\n\nWould you like to see specific pieces from any of these collections?"
  ],
  materials: [
    "üíé Our Premium Materials üíé\n\n‚Ä¢ Gold: 18K & 22K (916 BIS Hallmark Certified)\n‚Ä¢ Diamonds: VS+ Clarity, Excellent Cut (GIA/IGI Certified)\n‚Ä¢ Gemstones: Natural, ethically sourced (with certification)\n‚Ä¢ Polki & Kundan: Hand-cut and set by master craftsmen\n‚Ä¢ Meenakari: Traditional enamel work using vibrant colors\n\nAll our materials are ethically sourced and certified. We provide BIS Hallmark certification for all gold jewelry.",
    "‚ú® Quality You Can Trust ‚ú®\n\n‚Ä¢ Gold: 100% pure, BIS Hallmarked (22K/18K/14K)\n‚Ä¢ Diamonds: GIA/IGI certified, conflict-free (D-J color, VS+ clarity)\n‚Ä¢ Gemstones: Natural, untreated stones with certification\n‚Ä¢ Craftsmanship: Handmade by skilled artisans with years of experience\n\nWe use traditional Indian jewelry-making techniques combined with modern quality standards to create pieces that last for generations."
  ],
  care: [
    "üîç Jewelry Care & Storage Guide üîç\n\nProper Storage is Essential:\n‚Ä¢ Store each piece separately in soft pouches or lined jewelry boxes\n‚Ä¢ Keep away from direct sunlight and humidity\n‚Ä¢ Use anti-tarnish strips for silver jewelry\n‚Ä¢ Store chains fastened to prevent tangling\n\nDaily Care Tips:\n‚Ä¢ Put jewelry on after applying makeup and perfume\n‚Ä¢ Remove before swimming, cleaning, or exercising\n‚Ä¢ Clean with a soft, lint-free cloth after each wear\n‚Ä¢ Get professional cleaning every 6-12 months\n\nFor Gold & Diamond Jewelry:\n‚Ä¢ Clean with mild soap and lukewarm water\n‚Ä¢ Use a soft toothbrush for intricate designs\n‚Ä¢ Rinse and dry thoroughly\n‚Ä¢ Store in individual compartments\n\nFor Kundan & Polki:\n‚Ä¢ Avoid contact with water and chemicals\n‚Ä¢ Wipe gently with a dry cloth\n‚Ä¢ Store with silica gel packets to absorb moisture\n‚Ä¢ Professional cleaning recommended",
    "üíé Jewelry Maintenance Guide üíé\n\nCleaning Schedule:\n‚Ä¢ Gold: Monthly cleaning with jewelry cleaning solution\n‚Ä¢ Silver: Polish with a silver cloth weekly\n‚Ä¢ Diamonds: Clean monthly to maintain sparkle\n‚Ä¢ Gemstones: Clean every 2-3 months\n\nStorage Solutions:\n‚Ä¢ Use felt-lined jewelry boxes with dividers\n‚Ä¢ Hang necklaces on padded hangers\n‚Ä¢ Store earrings in designated compartments\n‚Ä¢ Keep pearls separate from other jewelry\n\nTravel Tips:\n‚Ä¢ Use a travel jewelry case with compartments\n‚Ä¢ Keep jewelry in your carry-on when flying\n‚Ä¢ Pack each piece separately\n‚Ä¢ Bring a small cleaning cloth"
  ],
  pricing: [
    "üí∞ Our Pricing Structure üí∞\n\nOur jewelry is priced based on several factors:\n‚Ä¢ Current gold/diamond/gemstone rates\n‚Ä¢ Design complexity and craftsmanship\n‚Ä¢ Stone quality and carat weight\n‚Ä¢ Customization requirements\n\nPrice Ranges (Approximate):\n‚Ä¢ Gold Jewelry: Starting from ‚Çπ25,000\n‚Ä¢ Diamond Jewelry: Starting from ‚Çπ50,000\n‚Ä¢ Polki/Kundan Sets: Starting from ‚Çπ75,000\n‚Ä¢ Bridal Sets: Starting from ‚Çπ1,50,000\n\nFor exact pricing, please share details of the specific piece you're interested in.",
    "üíé Understanding Jewelry Pricing üíé\n\nWhy the price difference?\n‚Ä¢ 22K gold vs. 18K gold\n‚Ä¢ Diamond quality (cut, color, clarity, carat)\n‚Ä¢ Handmade vs. machine-made pieces\n‚Ä¢ Intricacy of design and labor involved\n\nWe offer:\n‚Ä¢ Transparent pricing (gold weight + making charges)\n‚Ä¢ 100% BIS Hallmark certification\n‚Ä¢ Lifetime maintenance services\n‚Ä¢ Buyback policy on gold jewelry\n\nWould you like a quote for a specific piece?"
  ],
  customization: [
    "‚ú® Custom Jewelry Design Service ‚ú®\n\nAt Dissara, we offer customization of existing designs to better suit your preferences. Please note that while we can customize orders, we currently do not offer personalized jewelry services.\n\nWhat we can customize:\n‚Ä¢ Adjustments to existing designs (size, length, etc.)\n‚Ä¢ Stone substitutions within our collection\n‚Ä¢ Metal type and color changes\n‚Ä¢ Minor design modifications\n\nWhat we cannot do currently:\n‚Ä¢ Personalized engravings or names\n‚Ä¢ Completely custom designs from scratch\n‚Ä¢ Replicas of designer pieces\n\nWould you like to explore our customizable collections?",
    "üíé Customization Options üíé\n\nWe're happy to help customize your order within these parameters:\n‚Ä¢ Size adjustments to fit you perfectly\n‚Ä¢ Metal variations (gold color, karat options)\n‚Ä¢ Stone alternatives from our collection\n‚Ä¢ Chain length modifications\n\nPlease note: We currently cannot accept requests for personalized engravings or completely custom designs. Our artisans can work with you to modify existing designs to better suit your needs while maintaining the quality and integrity of our jewelry."
  ],
  shipping: [
    "üöö Shipping & Delivery Information üöö\n\n‚Ä¢ Free Shipping: On all orders above ‚Çπ50,000\n‚Ä¢ Standard Delivery: 7-10 business days\n‚Ä¢ Express Delivery: 3-5 business days (additional charges apply)\n‚Ä¢ International Shipping: Available to select countries\n\nAll orders include:\n‚Ä¢ Insurance coverage\n‚Ä¢ Real-time tracking\n‚Ä¢ Safe and secure packaging\n‚Ä¢ 7-day easy returns",
    "üì¶ Order Processing & Delivery üì¶\n\nProcessing Time:\n‚Ä¢ Ready-to-ship: 1-2 business days\n‚Ä¢ Custom orders: 15-30 business days\n‚Ä¢ Made-to-order: 8-12 weeks\n\nWe offer:\n‚Ä¢ Cash on Delivery (India only)\n‚Ä¢ Multiple payment options\n‚Ä¢ Safe and insured delivery\n‚Ä¢ Free resizing within 30 days\n\nNeed faster delivery? Contact us for express options!"
  ],
  contact: [
    "üìû Contact Dissara Jewelry üìç\n\n‚Ä¢ Phone: +91 98765 43210\n‚Ä¢ WhatsApp: +91 98765 43210\n‚Ä¢ Email: info@dissara.com\n\nüìç Showroom Address:\n123 Jewelers Street, Zaveri Bazaar,\nMumbai - 400002, India\n\n‚è∞ Business Hours:\nMonday to Saturday: 10:30 AM - 8:00 PM\nSunday: 11:00 AM - 6:00 PM\n\nBook a private consultation for a personalized experience!",
    "üíé Get In Touch With Us üíé\n\nFor Inquiries:\n‚Ä¢ Call/WhatsApp: +91 98765 43210\n‚Ä¢ Email: info@dissara.com\n\nCustomer Support:\n‚Ä¢ Returns & Exchanges: support@dissara.com\n‚Ä¢ Custom Orders: custom@dissara.com\n‚Ä¢ Wholesale Inquiries: wholesale@dissara.com\n\nVisit our showroom for a personal consultation and to view our latest collections in person!"
  ],
  compliments: [
    "Thank you for your kind words! I'm here to help you find or create the perfect jewelry piece. What would you like to explore today?",
    "I truly appreciate your appreciation! At Dissara, we pour our heart into every piece. How may I assist you further in your jewelry journey?",
    "Your kind words mean the world to us! Is there a particular collection or type of jewelry you'd like to know more about?",
    "Thank you for your lovely compliment! It's our pleasure to help you find something special. What are you looking for today?"
  ],
  farewell: [
    "Thank you for visiting Dissara! May your day sparkle as brightly as our diamonds. Feel free to return if you have more questions or need assistance.",
    "It was a pleasure assisting you today! Wishing you a day as beautiful as the jewelry we create. Come back soon!",
    "Dhanyavaad for choosing Dissara! May your life be as radiant as the gems we work with. Until next time! üôè‚ú®",
    "Thank you for your time! Remember, every piece of jewelry tells a story - we'd love to help you write yours. Have a wonderful day ahead!"
  ]
};

// Show typing indicator in the chat
function showTypingIndicator() {
  // Remove any existing typing indicator
  hideTypingIndicator();
  
  const chatBox = document.getElementById('chat-box');
  const typingDiv = document.createElement('div');
  typingDiv.className = 'typing-indicator';
  typingDiv.id = 'typing-indicator';
  typingDiv.innerHTML = '<span></span><span></span><span></span>';
  typingDiv.style.display = 'flex';
  chatBox.appendChild(typingDiv);
  chatBox.scrollTop = chatBox.scrollHeight;
}

// Hide typing indicator
function hideTypingIndicator() {
  const typingIndicator = document.getElementById('typing-indicator');
  if (typingIndicator) {
    typingIndicator.remove();
  }
}

// Add message to chat
function addMessage(message, isUser = false) {
  const chatBox = document.getElementById('chat-box');
  const messageDiv = document.createElement('div');
  messageDiv.className = `message ${isUser ? 'user-message' : 'bot-message'}`;
  
  // Replace newlines with <br> for proper line breaks
  messageDiv.innerHTML = message.replace(/\n/g, '<br>');
  
  chatBox.appendChild(messageDiv);
  chatBox.scrollTop = chatBox.scrollHeight;
}

// Enhanced response handler with better pattern matching and personalization
function getBotResponse(message) {
  message = message.toLowerCase().trim();
  
  // Check for greeting with name
  const nameMatch = message.match(/^(hi|hello|hey|hii|namaste|greetings|good (morning|afternoon|evening))\s*(perry|dear|sir|ma'am|miss|mr|mrs)?\s*([^.!?]*)[.!?]*$/i);
  if (nameMatch) {
    const userName = nameMatch[3] ? nameMatch[3].trim() : '';
    if (userName && !['perry', 'dear', 'sir', 'ma\'am', 'miss', 'mr', 'mrs'].includes(userName.toLowerCase())) {
      return `Namaste ${userName}! üôè I'm Perry, your personal jewelry assistant. It's lovely to meet you! How can I help you explore our collection today?`;
    }
    return randomResponse(jewelryKnowledge.greetings);
  }
  
  // About Dissara
  if (/(who are you|what is dissara|about dissara|tell me about dissara)/i.test(message)) {
    return randomResponse(jewelryKnowledge.aboutDissara);
  }
  
  // Collections
  if (/(collections|what do you have|show me|browse|products|jewelry types)/i.test(message)) {
    return randomResponse(jewelryKnowledge.collections);
  }
  
  // Materials
  if (/(materials|what is it made of|gold|silver|platinum|diamond|gemstone|karat)/i.test(message)) {
    return randomResponse(jewelryKnowledge.materials);
  }
  
  // Care
  if (/(care|clean|maintain|take care|store|polish)/i.test(message)) {
    return randomResponse(jewelryKnowledge.care);
  }
  
  // Pricing
  if (/(price|cost|how much|expensive|cheap|affordable)/i.test(message)) {
    return randomResponse(jewelryKnowledge.pricing);
  }
  
  // Customization
  if (/(custom|design my own|personalized|bespoke|made to order)/i.test(message)) {
    return randomResponse(jewelryKnowledge.customization);
  }
  
  // Shipping
  if (/(shipping|delivery|how long|when will it arrive|track)/i.test(message)) {
    return randomResponse(jewelryKnowledge.shipping);
  }
  
  // Contact
  if (/(contact|how to reach|phone number|email|address|showroom)/i.test(message)) {
    return randomResponse(jewelryKnowledge.contact);
  }
  
  // Compliments
  if (/(thank|thanks|appreciate|helpful|nice|good|great|amazing|love)/i.test(message)) {
    return randomResponse(jewelryKnowledge.compliments);
  }
  
  // Farewell
  if (/(bye|goodbye|see you|take care|have a good day)/i.test(message)) {
    return randomResponse(jewelryKnowledge.farewell);
  }
  
  // Default response for unknown queries
  const defaultResponses = [
    "I'm sorry, I didn't quite catch that. Could you please rephrase? I can help you with jewelry collections, pricing, care tips, and more!",
    "I want to make sure I understand you correctly. Could you try asking in a different way? I'm here to help with all your jewelry needs!",
    "I'm still learning! Could you try asking about our jewelry collections, pricing, or care instructions? I'm here to help!",
    "I'd love to help! Could you tell me more about what you're looking for? For example, you could ask about our bridal collection, daily wear jewelry, or custom designs.",
    "I'm here to assist with all things jewelry! Try asking about our collections, materials, or any other jewelry-related questions you might have."
  ];
  return defaultResponses[Math.floor(Math.random() * defaultResponses.length)];
}

// Helper function to get random response from an array
function randomResponse(responses) {
  return responses[Math.floor(Math.random() * responses.length)];
}

async function sendMessage() {
  const input = document.getElementById('user-input');
  const message = input.value.trim();
  
  if (!message) return;
  
  // Add user message to chat
  addMessage(message, true);
  input.value = '';
  
  // Show typing indicator
  showTypingIndicator();
  
  // Simulate typing delay
  setTimeout(() => {
    // Hide typing indicator
    hideTypingIndicator();
    
    // Get bot response
    const botResponse = getBotResponse(message);
    
    // Add bot response to chat
    addMessage(botResponse, false);
    
    // If it's a greeting, show quick suggestions
    if (/(hi|hello|hey|hii|what can you do)/i.test(message)) {
      setTimeout(() => {
        const suggestions = document.querySelector('.suggestions');
        if (suggestions) {
          suggestions.style.display = 'flex';
        }
      }, 500);
    }
  }, 1000 + Math.random() * 1000); // Random delay between 1-2 seconds
}

// Function to insert suggestion into input
function insertSuggestion(text) {
  const input = document.getElementById('user-input');
  input.value = text;
  input.focus();
  
  // Hide suggestions after selection
  const suggestions = document.querySelector('.suggestions');
  if (suggestions) {
    suggestions.style.display = 'none';
  }
}

// Allow sending message with Enter key
document.addEventListener('DOMContentLoaded', function() {
  const input = document.getElementById('user-input');
  
  if (input) {
    input.addEventListener('keypress', function(e) {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });
  }
  
  // Track if welcome message has been shown
  let welcomeShown = false;
  
  // Show initial welcome message after a short delay if not shown yet
  if (!welcomeShown) {
    setTimeout(() => {
      const welcomeMessage = "Hello! I'm Perry, your personal jewelry assistant at Dissara. I can help you with:\n‚Ä¢ Jewelry collections & designs\n‚Ä¢ Materials & care\n‚Ä¢ Pricing & customization\n‚Ä¢ Order information\n\nHow may I assist you today?";
      addMessage(welcomeMessage, false);
      welcomeShown = true;
    }, 500);
  }
});

// Make functions available globally
window.sendMessage = sendMessage;
window.insertSuggestion = insertSuggestion;
